"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const ava_1 = require("ava");
const denali_1 = require("denali");
const lodash_1 = require("lodash");
ava_1.default.beforeEach((t) => {
    t.context.container = new denali_1.Container(__dirname);
});
// Ensure a given finder method invokes it's corresponding adapter method
function finderInvokesAdapter(t, finder, adapterReturn, ...args) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        t.plan(1);
        let container = t.context.container;
        container.register('service:db', denali_1.DatabaseService);
        container.register('model:post', class Post extends denali_1.Model {
        });
        container.register('orm-adapter:post', {
            buildRecord() { return {}; },
            [finder]() {
                t.pass();
                return adapterReturn;
            },
            getAttribute() { return null; }
        }, { instantiate: false, singleton: true });
        let db = container.lookup('service:db');
        yield db[finder]('post', ...args);
    });
}
finderInvokesAdapter.title = (providedTitle, finder) => `db.${finder} invokes the ${finder} method on the adapter`;
// Check the results of a finder method call, and stub out the corresponding adapter method
function finderReturns(t, options) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        t.plan(1);
        let container = t.context.container;
        container.register('service:db', denali_1.DatabaseService);
        container.register('model:post', class Post extends denali_1.Model {
        });
        container.register('orm-adapter:post', {
            buildRecord() { return {}; },
            [options.finder]: options.adapterMethod,
            getAttribute() { return null; }
        }, { instantiate: false, singleton: true });
        let db = container.lookup('service:db');
        let result = yield db[options.finder]('post', options.arg);
        options.assert(t, result);
    });
}
ava_1.default(finderInvokesAdapter, 'find', {}, 1);
ava_1.default(finderInvokesAdapter, 'queryOne', {}, { foo: true });
ava_1.default(finderInvokesAdapter, 'all', []);
ava_1.default(finderInvokesAdapter, 'query', [], { foo: true });
ava_1.default('find returns model instance', finderReturns, {
    finder: 'find',
    arg: 1,
    adapterMethod() { return {}; },
    assert(t, result) {
        t.true(result instanceof denali_1.Model);
    }
});
ava_1.default('find returns null if adapter does', finderReturns, {
    finder: 'find',
    arg: 1,
    adapterMethod() { return null; },
    assert(t, result) {
        t.is(result, null);
    }
});
ava_1.default('queryOne returns model instance', finderReturns, {
    finder: 'queryOne',
    arg: { foo: true },
    adapterMethod() { return {}; },
    assert(t, result) {
        t.true(result instanceof denali_1.Model);
    }
});
ava_1.default('queryOne returns null if adapter does', finderReturns, {
    finder: 'queryOne',
    arg: { foo: true },
    adapterMethod() { return null; },
    assert(t, result) {
        t.is(result, null);
    }
});
ava_1.default('all returns an array', finderReturns, {
    finder: 'all',
    arg: undefined,
    adapterMethod() { return []; },
    assert(t, result) {
        t.true(lodash_1.isArray(result));
    }
});
ava_1.default('query returns an array', finderReturns, {
    finder: 'query',
    arg: { foo: true },
    adapterMethod() { return []; },
    assert(t, result) {
        t.true(lodash_1.isArray(result));
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWJhc2UtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvYWNidXJkaW5lL1Byb2plY3RzL2RlbmFsaS9kZW5hbGkvIiwic291cmNlcyI6WyJ0ZXN0L3VuaXQvZGF0YS9kYXRhYmFzZS10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZCQUFpRDtBQUNqRCxtQ0FBMkQ7QUFDM0QsbUNBQWlDO0FBRWpDLGFBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ2hCLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksa0JBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNqRCxDQUFDLENBQUMsQ0FBQztBQUVILHlFQUF5RTtBQUN6RSw4QkFBb0MsQ0FBNkIsRUFBRSxNQUE2QixFQUFFLGFBQWtCLEVBQUUsR0FBRyxJQUFXOztRQUNsSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxTQUFTLEdBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDL0MsU0FBUyxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsd0JBQWUsQ0FBQyxDQUFDO1FBQ2xELFNBQVMsQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLFVBQVcsU0FBUSxjQUFLO1NBQUcsQ0FBQyxDQUFDO1FBQzlELFNBQVMsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLEVBQUU7WUFDckMsV0FBVyxLQUFLLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsTUFBTSxDQUFDO2dCQUNOLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVCxNQUFNLENBQUMsYUFBYSxDQUFDO1lBQ3ZCLENBQUM7WUFDRCxZQUFZLEtBQVUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckMsRUFBRSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDNUMsSUFB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ImltcG9ydCB0ZXN0LCB7IFRlc3RDb250ZXh0LCBDb250ZXh0IH0gZnJvbSAnYXZhJztcbmltcG9ydCB7IE1vZGVsLCBDb250YWluZXIsIERhdGFiYXNlU2VydmljZSB9IGZyb20gJ2RlbmFsaSc7XG5pbXBvcnQgeyBpc0FycmF5IH0gZnJvbSAnbG9kYXNoJztcblxudGVzdC5iZWZvcmVFYWNoKCh0KSA9PiB7XG4gIHQuY29udGV4dC5jb250YWluZXIgPSBuZXcgQ29udGFpbmVyKF9fZGlybmFtZSk7XG59KTtcblxuLy8gRW5zdXJlIGEgZ2l2ZW4gZmluZGVyIG1ldGhvZCBpbnZva2VzIGl0J3MgY29ycmVzcG9uZGluZyBhZGFwdGVyIG1ldGhvZFxuYXN5bmMgZnVuY3Rpb24gZmluZGVySW52b2tlc0FkYXB0ZXIodDogVGVzdENvbnRleHQgJiBDb250ZXh0PGFueT4sIGZpbmRlcjoga2V5b2YgRGF0YWJhc2VTZXJ2aWNlLCBhZGFwdGVyUmV0dXJuOiBhbnksIC4uLmFyZ3M6IGFueVtdKSB7XG4gIHQucGxhbigxKTtcbiAgbGV0IGNvbnRhaW5lcjogQ29udGFpbmVyID0gdC5jb250ZXh0LmNvbnRhaW5lcjtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdzZXJ2aWNlOmRiJywgRGF0YWJhc2VTZXJ2aWNlKTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdtb2RlbDpwb3N0JywgY2xhc3MgUG9zdCBleHRlbmRzIE1vZGVsIHt9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdvcm0tYWRhcHRlcjpwb3N0Jywge1xuICAgIGJ1aWxkUmVjb3JkKCkgeyByZXR1cm4ge307IH0sXG4gICAgW2ZpbmRlcl0oKSB7XG4gICAgICB0LnBhc3MoKTtcbiAgICAgIHJldHVybiBhZGFwdGVyUmV0dXJuO1xuICAgIH0sXG4gICAgZ2V0QXR0cmlidXRlKCk6IGFueSB7IHJldHVybiBudWxsOyB9XG4gIH0sIHsgaW5zdGFudGlhdGU6IGZhbHNlLCBzaW5nbGV0b246IHRydWUgfSk7XG4gIGxldCBkYiA9IGNvbnRhaW5lci5sb29rdXA8RGF0YWJhc2VTZXJ2aWNlPignc2VydmljZTpkYicpO1xuICBhd2FpdCAoPGFueT5kYltmaW5kZXJdKSgncG9zdCcsIC4uLmFyZ3MpO1xufVxuKDxhbnk+ZmluZGVySW52b2tlc0FkYXB0ZXIpLnRpdGxlID0gKHByb3ZpZGVkVGl0bGU6IHN0cmluZywgZmluZGVyOiBzdHJpbmcpID0+IGBkYi4keyBmaW5kZXIgfSBpbnZva2VzIHRoZSAkeyBmaW5kZXIgfSBtZXRob2Qgb24gdGhlIGFkYXB0ZXJgO1xuXG4vLyBDaGVjayB0aGUgcmVzdWx0cyBvZiBhIGZpbmRlciBtZXRob2QgY2FsbCwgYW5kIHN0dWIgb3V0IHRoZSBjb3JyZXNwb25kaW5nIGFkYXB0ZXIgbWV0aG9kXG5hc3luYyBmdW5jdGlvbiBmaW5kZXJSZXR1cm5zKHQ6IFRlc3RDb250ZXh0ICYgQ29udGV4dDxhbnk+LCBvcHRpb25zOiB7XG4gIGZpbmRlcjoga2V5b2YgRGF0YWJhc2VTZXJ2aWNlLFxuICBhcmc6IGFueSxcbiAgYWRhcHRlck1ldGhvZCgpOiBhbnksXG4gIGFzc2VydCh0OiBUZXN0Q29udGV4dCwgcmVzdWx0OiBhbnkpOiB2b2lkXG59KSB7XG4gIHQucGxhbigxKTtcbiAgbGV0IGNvbnRhaW5lcjogQ29udGFpbmVyID0gdC5jb250ZXh0LmNvbnRhaW5lcjtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdzZXJ2aWNlOmRiJywgRGF0YWJhc2VTZXJ2aWNlKTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdtb2RlbDpwb3N0JywgY2xhc3MgUG9zdCBleHRlbmRzIE1vZGVsIHt9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdvcm0tYWRhcHRlcjpwb3N0Jywge1xuICAgIGJ1aWxkUmVjb3JkKCkgeyByZXR1cm4ge307IH0sXG4gICAgW29wdGlvbnMuZmluZGVyXTogb3B0aW9ucy5hZGFwdGVyTWV0aG9kLFxuICAgIGdldEF0dHJpYnV0ZSgpOiBudWxsIHsgcmV0dXJuIG51bGw7IH1cbiAgfSwgeyBpbnN0YW50aWF0ZTogZmFsc2UsIHNpbmdsZXRvbjogdHJ1ZSB9KTtcbiAgbGV0IGRiID0gY29udGFpbmVyLmxvb2t1cDxEYXRhYmFzZVNlcnZpY2U+KCdzZXJ2aWNlOmRiJyk7XG4gIGxldCByZXN1bHQgPSBhd2FpdCAoPGFueT5kYltvcHRpb25zLmZpbmRlcl0pKCdwb3N0Jywgb3B0aW9ucy5hcmcpO1xuICBvcHRpb25zLmFzc2VydCh0LCByZXN1bHQpO1xufVxuXG50ZXN0KGZpbmRlckludm9rZXNBZGFwdGVyLCAnZmluZCcsIHt9LCAxKTtcblxudGVzdChmaW5kZXJJbnZva2VzQWRhcHRlciwgJ3F1ZXJ5T25lJywge30sIHsgZm9vOiB0cnVlIH0pO1xuXG50ZXN0KGZpbmRlckludm9rZXNBZGFwdGVyLCAnYWxsJywgW10pO1xuXG50ZXN0KGZpbmRlckludm9rZXNBZGFwdGVyLCAncXVlcnknLCBbXSwgeyBmb286IHRydWUgfSk7XG5cbnRlc3QoJ2ZpbmQgcmV0dXJucyBtb2RlbCBpbnN0YW5jZScsIGZpbmRlclJldHVybnMsIHtcbiAgZmluZGVyOiAnZmluZCcsXG4gIGFyZzogMSxcbiAgYWRhcHRlck1ldGhvZCgpIHsgcmV0dXJuIHt9OyB9LFxuICBhc3NlcnQodDogVGVzdENvbnRleHQsIHJlc3VsdDogYW55KSB7XG4gICAgdC50cnVlKHJlc3VsdCBpbnN0YW5jZW9mIE1vZGVsKTtcbiAgfVxufSk7XG5cbnRlc3QoJ2ZpbmQgcmV0dXJucyBudWxsIGlmIGFkYXB0ZXIgZG9lcycsIGZpbmRlclJldHVybnMsIHtcbiAgZmluZGVyOiAnZmluZCcsXG4gIGFyZzogMSxcbiAgYWRhcHRlck1ldGhvZCgpOiBudWxsIHsgcmV0dXJuIG51bGw7IH0sXG4gIGFzc2VydCh0OiBUZXN0Q29udGV4dCwgcmVzdWx0OiBhbnkpIHtcbiAgICB0LmlzKHJlc3VsdCwgbnVsbCk7XG4gIH1cbn0pO1xuXG50ZXN0KCdxdWVyeU9uZSByZXR1cm5zIG1vZGVsIGluc3RhbmNlJywgZmluZGVyUmV0dXJucywge1xuICBmaW5kZXI6ICdxdWVyeU9uZScsXG4gIGFyZzogeyBmb286IHRydWUgfSxcbiAgYWRhcHRlck1ldGhvZCgpIHsgcmV0dXJuIHt9OyB9LFxuICBhc3NlcnQodDogVGVzdENvbnRleHQsIHJlc3VsdDogYW55KSB7XG4gICAgdC50cnVlKHJlc3VsdCBpbnN0YW5jZW9mIE1vZGVsKTtcbiAgfVxufSk7XG5cbnRlc3QoJ3F1ZXJ5T25lIHJldHVybnMgbnVsbCBpZiBhZGFwdGVyIGRvZXMnLCBmaW5kZXJSZXR1cm5zLCB7XG4gIGZpbmRlcjogJ3F1ZXJ5T25lJyxcbiAgYXJnOiB7IGZvbzogdHJ1ZSB9LFxuICBhZGFwdGVyTWV0aG9kKCk6IG51bGwgeyByZXR1cm4gbnVsbDsgfSxcbiAgYXNzZXJ0KHQ6IFRlc3RDb250ZXh0LCByZXN1bHQ6IGFueSkge1xuICAgIHQuaXMocmVzdWx0LCBudWxsKTtcbiAgfVxufSk7XG5cbnRlc3QoJ2FsbCByZXR1cm5zIGFuIGFycmF5JywgZmluZGVyUmV0dXJucywge1xuICBmaW5kZXI6ICdhbGwnLFxuICBhcmc6IHVuZGVmaW5lZCxcbiAgYWRhcHRlck1ldGhvZCgpOiBhbnlbXSB7IHJldHVybiBbXTsgfSxcbiAgYXNzZXJ0KHQ6IFRlc3RDb250ZXh0LCByZXN1bHQ6IGFueSkge1xuICAgIHQudHJ1ZShpc0FycmF5KHJlc3VsdCkpO1xuICB9XG59KTtcblxudGVzdCgncXVlcnkgcmV0dXJucyBhbiBhcnJheScsIGZpbmRlclJldHVybnMsIHtcbiAgZmluZGVyOiAncXVlcnknLFxuICBhcmc6IHsgZm9vOiB0cnVlIH0sXG4gIGFkYXB0ZXJNZXRob2QoKTogYW55W10geyByZXR1cm4gW107IH0sXG4gIGFzc2VydCh0OiBUZXN0Q29udGV4dCwgcmVzdWx0OiBhbnkpIHtcbiAgICB0LnRydWUoaXNBcnJheShyZXN1bHQpKTtcbiAgfVxufSk7XG4iXX0=