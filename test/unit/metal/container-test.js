"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
/* tslint:disable:completed-docs no-empty no-invalid-this member-access */
const ava_1 = require("ava");
const denali_1 = require("denali");
const path = require("path");
const dummyAppPath = path.join(__dirname, '..', 'dummy');
ava_1.default('metaFor returns a container-scoped metadata object', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    let key = {};
    let meta = container.metaFor(key);
    meta.foo = true;
    t.is(container.metaFor(key), meta);
    let otherContainer = new denali_1.Container(dummyAppPath);
    t.not(otherContainer.metaFor(key), meta);
}));
ava_1.default('get/setOption allows options per type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('type', 'singleton', true);
    t.true(container.getOption('type', 'singleton'));
    t.true(container.getOption('type:entry', 'singleton'));
}));
ava_1.default('get/setOption allows options per specifier', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('type:entry', 'singleton', true);
    t.true(container.getOption('type:entry', 'singleton'));
}));
ava_1.default('instantiate: true, singleton: true', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', true);
    container.setOption('foo', 'instantiate', true);
    class Foo {
    }
    container.register('foo:main', Foo);
    let result = container.lookup('foo:main');
    t.true(result instanceof Foo);
    t.is(result, container.lookup('foo:main'));
}));
ava_1.default('instantiate: false, singleton: true', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', true);
    container.setOption('foo', 'instantiate', false);
    let foo = {};
    container.register('foo:main', foo);
    let result = container.lookup('foo:main');
    t.is(result, foo);
    t.is(result, container.lookup('foo:main'));
}));
ava_1.default('instantiate: true, singleton: false', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', false);
    container.setOption('foo', 'instantiate', true);
    class Foo {
    }
    container.register('foo:main', Foo);
    let result = container.lookup('foo:main');
    t.true(result instanceof Foo);
    t.not(result, container.lookup('foo:main'));
}));
ava_1.default('register(type, value) registers a value on the container', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { buzz: true }, { singleton: true, instantiate: false });
    t.true(container.lookup('foo:bar').buzz);
}));
ava_1.default('lookup(type) looks up a module', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { buzz: true }, { singleton: true, instantiate: false });
    t.true(container.lookup('foo:bar').buzz);
}));
ava_1.default('lookupAll(type) returns an object with all the modules of the given type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { isBar: true }, { singleton: true, instantiate: false });
    container.register('foo:buzz', { isBuzz: true }, { singleton: true, instantiate: false });
    let type = container.lookupAll('foo');
    t.truthy(type.bar);
    t.true(type.bar.isBar);
    t.truthy(type.buzz);
    t.true(type.buzz.isBuzz);
}));
ava_1.default('instantiates a singleton', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    class Class {
    }
    container.register('foo:bar', Class, { singleton: true, instantiate: true });
    let classInstance = container.lookup('foo:bar');
    let classInstanceTwo = container.lookup('foo:bar');
    t.true(classInstance instanceof Class);
    t.is(classInstanceTwo, classInstance);
}));
ava_1.default('lazily instantiates singletons (i.e. on lookup)', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    function Class() {
        t.fail('Class should not have been instantiated.');
    }
    container.register('foo:bar', Class, { singleton: true });
    t.pass();
}));
ava_1.default('availableForType() returns all registered instances of a type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:a', { a: true }, { singleton: true, instantiate: false });
    container.register('foo:b', { b: true }, { singleton: true, instantiate: false });
    container.register('foo:c', { c: true }, { singleton: true, instantiate: false });
    container.register('foo:d', { d: true }, { singleton: true, instantiate: false });
    t.deepEqual(container.availableForType('foo'), ['a', 'b', 'c', 'd']);
}));
ava_1.default('properties marked as injections are injected', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('bar:main', { isPresent: true }, { singleton: true, instantiate: false });
    container.register('foo:main', { bar: denali_1.inject('bar:main') }, { singleton: true, instantiate: false });
    let foo = container.lookup('foo:main');
    t.true(foo.bar.isPresent, 'injection was applied');
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLXRlc3QuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2FidXJkaW5lL1Byb2plY3RzL2RlbmFsaS9tYWluLyIsInNvdXJjZXMiOlsidGVzdC91bml0L21ldGFsL2NvbnRhaW5lci10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBFQUEwRTtBQUMxRSw2QkFBdUI7QUFDdkIsbUNBQTJDO0FBQzNDLDZCQUE2QjtBQUU3QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFekQsYUFBSSxDQUFDLG9EQUFvRCxFQUFFLENBQU8sQ0FBQztJQUNqRSxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsSUFBSSxJQUFJLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUNoQixDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFbkMsSUFBSSxjQUFjLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLHVDQUF1QyxFQUFFLENBQU8sQ0FBQztJQUNwRCxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDekQsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUVILGFBQUksQ0FBQyw0Q0FBNEMsRUFBRSxDQUFPLENBQUM7SUFDekQsSUFBSSxTQUFTLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDLFNBQVMsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNyRCxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDekQsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUVILGFBQUksQ0FBQyxvQ0FBb0MsRUFBRSxDQUFPLENBQUM7SUFDakQsSUFBSSxTQUFTLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFaEQ7S0FBWTtJQUNaLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFMUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQzdDLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMscUNBQXFDLEVBQUUsQ0FBTyxDQUFDO0lBQ2xELElBQUksU0FBUyxHQUFHLElBQUksa0JBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1QyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWpELElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFMUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQzdDLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMscUNBQXFDLEVBQUUsQ0FBTyxDQUFDO0lBQ2xELElBQUksU0FBUyxHQUFHLElBQUksa0JBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1QyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDL0MsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRWhEO0tBQVk7SUFDWixTQUFTLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNwQyxJQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRTFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztBQUM5QyxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLDBEQUEwRCxFQUFFLENBQU8sQ0FBQztJQUN2RSxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZGLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBTSxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLGdDQUFnQyxFQUFFLENBQU8sQ0FBQztJQUM3QyxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZGLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBTSxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLDBFQUEwRSxFQUFFLENBQU8sQ0FBQztJQUN2RixJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3hGLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUMxRixJQUFJLElBQUksR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFNLEtBQUssQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDM0IsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUVILGFBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFPLENBQUM7SUFDdkMsSUFBSSxTQUFTLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDO0tBQWM7SUFDZCxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBRTdFLElBQUksYUFBYSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDaEQsSUFBSSxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ25ELENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxZQUFZLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDeEMsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUVILGFBQUksQ0FBQyxpREFBaUQsRUFBRSxDQUFPLENBQUM7SUFDOUQsSUFBSSxTQUFTLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDO1FBQ0UsQ0FBQyxDQUFDLElBQUksQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFDRCxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUMxRCxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLCtEQUErRCxFQUFFLENBQU8sQ0FBQztJQUM1RSxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFFNUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2hGLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNoRixTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDaEYsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBRWhGLENBQUMsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN2RSxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLDhDQUE4QyxFQUFFLENBQU8sQ0FBQztJQUMzRCxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQzdGLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLEVBQUUsR0FBRyxFQUFFLGVBQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyRyxJQUFJLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFNLFVBQVUsQ0FBQyxDQUFDO0lBRTVDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztBQUNyRCxDQUFDLENBQUEsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogdHNsaW50OmRpc2FibGU6Y29tcGxldGVkLWRvY3Mgbm8tZW1wdHkgbm8taW52YWxpZC10aGlzIG1lbWJlci1hY2Nlc3MgKi9cbmltcG9ydCB0ZXN0IGZyb20gJ2F2YSc7XG5pbXBvcnQgeyBDb250YWluZXIsIGluamVjdCB9IGZyb20gJ2RlbmFsaSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5jb25zdCBkdW1teUFwcFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnZHVtbXknKTtcblxudGVzdCgnbWV0YUZvciByZXR1cm5zIGEgY29udGFpbmVyLXNjb3BlZCBtZXRhZGF0YSBvYmplY3QnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBsZXQga2V5ID0ge307XG4gIGxldCBtZXRhID0gY29udGFpbmVyLm1ldGFGb3Ioa2V5KTtcbiAgbWV0YS5mb28gPSB0cnVlO1xuICB0LmlzKGNvbnRhaW5lci5tZXRhRm9yKGtleSksIG1ldGEpO1xuXG4gIGxldCBvdGhlckNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgdC5ub3Qob3RoZXJDb250YWluZXIubWV0YUZvcihrZXkpLCBtZXRhKTtcbn0pO1xuXG50ZXN0KCdnZXQvc2V0T3B0aW9uIGFsbG93cyBvcHRpb25zIHBlciB0eXBlJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnNldE9wdGlvbigndHlwZScsICdzaW5nbGV0b24nLCB0cnVlKTtcbiAgdC50cnVlKGNvbnRhaW5lci5nZXRPcHRpb24oJ3R5cGUnLCAnc2luZ2xldG9uJykpO1xuICB0LnRydWUoY29udGFpbmVyLmdldE9wdGlvbigndHlwZTplbnRyeScsICdzaW5nbGV0b24nKSk7XG59KTtcblxudGVzdCgnZ2V0L3NldE9wdGlvbiBhbGxvd3Mgb3B0aW9ucyBwZXIgc3BlY2lmaWVyJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnNldE9wdGlvbigndHlwZTplbnRyeScsICdzaW5nbGV0b24nLCB0cnVlKTtcbiAgdC50cnVlKGNvbnRhaW5lci5nZXRPcHRpb24oJ3R5cGU6ZW50cnknLCAnc2luZ2xldG9uJykpO1xufSk7XG5cbnRlc3QoJ2luc3RhbnRpYXRlOiB0cnVlLCBzaW5nbGV0b246IHRydWUnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCdmb28nLCAnc2luZ2xldG9uJywgdHJ1ZSk7XG4gIGNvbnRhaW5lci5zZXRPcHRpb24oJ2ZvbycsICdpbnN0YW50aWF0ZScsIHRydWUpO1xuXG4gIGNsYXNzIEZvbyB7fVxuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzptYWluJywgRm9vKTtcbiAgbGV0IHJlc3VsdCA9IGNvbnRhaW5lci5sb29rdXAoJ2ZvbzptYWluJyk7XG5cbiAgdC50cnVlKHJlc3VsdCBpbnN0YW5jZW9mIEZvbyk7XG4gIHQuaXMocmVzdWx0LCBjb250YWluZXIubG9va3VwKCdmb286bWFpbicpKTtcbn0pO1xuXG50ZXN0KCdpbnN0YW50aWF0ZTogZmFsc2UsIHNpbmdsZXRvbjogdHJ1ZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5zZXRPcHRpb24oJ2ZvbycsICdzaW5nbGV0b24nLCB0cnVlKTtcbiAgY29udGFpbmVyLnNldE9wdGlvbignZm9vJywgJ2luc3RhbnRpYXRlJywgZmFsc2UpO1xuXG4gIGxldCBmb28gPSB7fTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286bWFpbicsIGZvbyk7XG4gIGxldCByZXN1bHQgPSBjb250YWluZXIubG9va3VwKCdmb286bWFpbicpO1xuXG4gIHQuaXMocmVzdWx0LCBmb28pO1xuICB0LmlzKHJlc3VsdCwgY29udGFpbmVyLmxvb2t1cCgnZm9vOm1haW4nKSk7XG59KTtcblxudGVzdCgnaW5zdGFudGlhdGU6IHRydWUsIHNpbmdsZXRvbjogZmFsc2UnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCdmb28nLCAnc2luZ2xldG9uJywgZmFsc2UpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCdmb28nLCAnaW5zdGFudGlhdGUnLCB0cnVlKTtcblxuICBjbGFzcyBGb28ge31cbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286bWFpbicsIEZvbyk7XG4gIGxldCByZXN1bHQgPSBjb250YWluZXIubG9va3VwKCdmb286bWFpbicpO1xuXG4gIHQudHJ1ZShyZXN1bHQgaW5zdGFuY2VvZiBGb28pO1xuICB0Lm5vdChyZXN1bHQsIGNvbnRhaW5lci5sb29rdXAoJ2ZvbzptYWluJykpO1xufSk7XG5cbnRlc3QoJ3JlZ2lzdGVyKHR5cGUsIHZhbHVlKSByZWdpc3RlcnMgYSB2YWx1ZSBvbiB0aGUgY29udGFpbmVyJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YmFyJywgeyBidXp6OiB0cnVlIH0sIHsgc2luZ2xldG9uOiB0cnVlLCBpbnN0YW50aWF0ZTogZmFsc2UgfSk7XG4gIHQudHJ1ZShjb250YWluZXIubG9va3VwPGFueT4oJ2ZvbzpiYXInKS5idXp6KTtcbn0pO1xuXG50ZXN0KCdsb29rdXAodHlwZSkgbG9va3MgdXAgYSBtb2R1bGUnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpiYXInLCB7IGJ1eno6IHRydWUgfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgdC50cnVlKGNvbnRhaW5lci5sb29rdXA8YW55PignZm9vOmJhcicpLmJ1enopO1xufSk7XG5cbnRlc3QoJ2xvb2t1cEFsbCh0eXBlKSByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGFsbCB0aGUgbW9kdWxlcyBvZiB0aGUgZ2l2ZW4gdHlwZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5yZWdpc3RlcignZm9vOmJhcicsIHsgaXNCYXI6IHRydWUgfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YnV6eicsIHsgaXNCdXp6OiB0cnVlIH0sIHsgc2luZ2xldG9uOiB0cnVlLCBpbnN0YW50aWF0ZTogZmFsc2UgfSk7XG4gIGxldCB0eXBlID0gY29udGFpbmVyLmxvb2t1cEFsbDxhbnk+KCdmb28nKTtcbiAgdC50cnV0aHkodHlwZS5iYXIpO1xuICB0LnRydWUodHlwZS5iYXIuaXNCYXIpO1xuICB0LnRydXRoeSh0eXBlLmJ1enopO1xuICB0LnRydWUodHlwZS5idXp6LmlzQnV6eik7XG59KTtcblxudGVzdCgnaW5zdGFudGlhdGVzIGEgc2luZ2xldG9uJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY2xhc3MgQ2xhc3Mge31cbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YmFyJywgQ2xhc3MsIHsgc2luZ2xldG9uOiB0cnVlLCBpbnN0YW50aWF0ZTogdHJ1ZSB9KTtcblxuICBsZXQgY2xhc3NJbnN0YW5jZSA9IGNvbnRhaW5lci5sb29rdXAoJ2ZvbzpiYXInKTtcbiAgbGV0IGNsYXNzSW5zdGFuY2VUd28gPSBjb250YWluZXIubG9va3VwKCdmb286YmFyJyk7XG4gIHQudHJ1ZShjbGFzc0luc3RhbmNlIGluc3RhbmNlb2YgQ2xhc3MpO1xuICB0LmlzKGNsYXNzSW5zdGFuY2VUd28sIGNsYXNzSW5zdGFuY2UpO1xufSk7XG5cbnRlc3QoJ2xhemlseSBpbnN0YW50aWF0ZXMgc2luZ2xldG9ucyAoaS5lLiBvbiBsb29rdXApJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgZnVuY3Rpb24gQ2xhc3MoKSB7XG4gICAgdC5mYWlsKCdDbGFzcyBzaG91bGQgbm90IGhhdmUgYmVlbiBpbnN0YW50aWF0ZWQuJyk7XG4gIH1cbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YmFyJywgQ2xhc3MsIHsgc2luZ2xldG9uOiB0cnVlIH0pO1xuICB0LnBhc3MoKTtcbn0pO1xuXG50ZXN0KCdhdmFpbGFibGVGb3JUeXBlKCkgcmV0dXJucyBhbGwgcmVnaXN0ZXJlZCBpbnN0YW5jZXMgb2YgYSB0eXBlJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcblxuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzphJywge2E6IHRydWV9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpiJywge2I6IHRydWV9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpjJywge2M6IHRydWV9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpkJywge2Q6IHRydWV9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuXG4gIHQuZGVlcEVxdWFsKGNvbnRhaW5lci5hdmFpbGFibGVGb3JUeXBlKCdmb28nKSwgWydhJywgJ2InLCAnYycsICdkJ10pO1xufSk7XG5cbnRlc3QoJ3Byb3BlcnRpZXMgbWFya2VkIGFzIGluamVjdGlvbnMgYXJlIGluamVjdGVkJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdiYXI6bWFpbicsIHsgaXNQcmVzZW50OiB0cnVlIH0sIHsgc2luZ2xldG9uOiB0cnVlLCBpbnN0YW50aWF0ZTogZmFsc2UgfSk7XG4gIGNvbnRhaW5lci5yZWdpc3RlcignZm9vOm1haW4nLCB7IGJhcjogaW5qZWN0KCdiYXI6bWFpbicpIH0sIHsgc2luZ2xldG9uOiB0cnVlLCBpbnN0YW50aWF0ZTogZmFsc2UgfSk7XG4gIGxldCBmb28gPSBjb250YWluZXIubG9va3VwPGFueT4oJ2ZvbzptYWluJyk7XG5cbiAgdC50cnVlKGZvby5iYXIuaXNQcmVzZW50LCAnaW5qZWN0aW9uIHdhcyBhcHBsaWVkJyk7XG59KTtcbiJdfQ==