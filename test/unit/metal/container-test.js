"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
/* tslint:disable:completed-docs no-empty no-invalid-this member-access */
const ava_1 = require("ava");
const denali_1 = require("denali");
const path = require("path");
const dummyAppPath = path.join(__dirname, '..', 'dummy');
ava_1.default('metaFor returns a container-scoped metadata object', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    let key = {};
    let meta = container.metaFor(key);
    meta.foo = true;
    t.is(container.metaFor(key), meta);
    let otherContainer = new denali_1.Container(dummyAppPath);
    t.not(otherContainer.metaFor(key), meta);
}));
ava_1.default('get/setOption allows options per type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('type', 'singleton', true);
    t.true(container.getOption('type', 'singleton'));
    t.true(container.getOption('type:entry', 'singleton'));
}));
ava_1.default('get/setOption allows options per specifier', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('type:entry', 'singleton', true);
    t.true(container.getOption('type:entry', 'singleton'));
}));
ava_1.default('instantiate: true, singleton: true', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', true);
    container.setOption('foo', 'instantiate', true);
    class Foo {
    }
    container.register('foo:main', Foo);
    let result = container.lookup('foo:main');
    t.true(result instanceof Foo);
    t.is(result, container.lookup('foo:main'));
}));
ava_1.default('instantiate: false, singleton: true', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', true);
    container.setOption('foo', 'instantiate', false);
    let foo = {};
    container.register('foo:main', foo);
    let result = container.lookup('foo:main');
    t.is(result, foo);
    t.is(result, container.lookup('foo:main'));
}));
ava_1.default('instantiate: true, singleton: false', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.setOption('foo', 'singleton', false);
    container.setOption('foo', 'instantiate', true);
    class Foo {
    }
    container.register('foo:main', Foo);
    let result = container.lookup('foo:main');
    t.true(result instanceof Foo);
    t.not(result, container.lookup('foo:main'));
}));
ava_1.default('should default unknown types to instantiate: false, singleton: true', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:main', { foo: true });
    let result = container.lookup('foo:main');
    t.true(result.foo);
}));
ava_1.default('register(type, value) registers a value on the container', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { buzz: true }, { singleton: true, instantiate: false });
    t.true(container.lookup('foo:bar').buzz);
}));
ava_1.default('lookup(type) looks up a module', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { buzz: true }, { singleton: true, instantiate: false });
    t.true(container.lookup('foo:bar').buzz);
}));
ava_1.default('lookupAll(type) returns an object with all the modules of the given type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:bar', { isBar: true }, { singleton: true, instantiate: false });
    container.register('foo:buzz', { isBuzz: true }, { singleton: true, instantiate: false });
    let type = container.lookupAll('foo');
    t.truthy(type.bar);
    t.true(type.bar.isBar);
    t.truthy(type.buzz);
    t.true(type.buzz.isBuzz);
}));
ava_1.default('lazily instantiates singletons (i.e. on lookup)', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    function Class() {
        t.fail('Class should not have been instantiated.');
    }
    container.register('foo:bar', Class, { singleton: true });
    t.pass();
}));
ava_1.default('availableForType() returns all registered instances of a type', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('foo:a', { a: true }, { singleton: true, instantiate: false });
    container.register('foo:b', { b: true }, { singleton: true, instantiate: false });
    container.register('foo:c', { c: true }, { singleton: true, instantiate: false });
    container.register('foo:d', { d: true }, { singleton: true, instantiate: false });
    t.deepEqual(container.availableForType('foo'), ['a', 'b', 'c', 'd']);
}));
ava_1.default('properties marked as injections are injected', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let container = new denali_1.Container(dummyAppPath);
    container.register('bar:main', { isPresent: true }, { singleton: true, instantiate: false });
    container.register('foo:main', { bar: denali_1.inject('bar:main') }, { singleton: true, instantiate: false });
    let foo = container.lookup('foo:main');
    t.true(foo.bar.isPresent, 'injection was applied');
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLXRlc3QuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2FjYnVyZGluZS9Qcm9qZWN0cy9kZW5hbGkvZGVuYWxpLyIsInNvdXJjZXMiOlsidGVzdC91bml0L21ldGFsL2NvbnRhaW5lci10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBFQUEwRTtBQUMxRSw2QkFBdUI7QUFDdkIsbUNBQTJDO0FBQzNDLDZCQUE2QjtBQUU3QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFekQsYUFBSSxDQUFDLG9EQUFvRCxFQUFFLENBQU8sQ0FBQztJQUNqRSxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsSUFBSSxJQUFJLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUNoQixDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFbkMsSUFBSSxjQUFjLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLHVDQUF1QyxFQUFFLENBQU8sQ0FBQztJQUNwRCxJQUFJLFNBQVMsR0FBRyxJQUFJLGtCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9DLENBQUMs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a0JBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1QyxTQUFTLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDN0YsU0FBUyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsRUFBRSxHQUFHLEVBQUUsZUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3JHLElBQUksR0FBRyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQU0sVUFBVSxDQUFDLENBQUM7SUFFNUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSx1QkFBdUIsQ0FBQyxDQUFDO0FBQ3JELENBQUMsQ0FBQSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpjb21wbGV0ZWQtZG9jcyBuby1lbXB0eSBuby1pbnZhbGlkLXRoaXMgbWVtYmVyLWFjY2VzcyAqL1xuaW1wb3J0IHRlc3QgZnJvbSAnYXZhJztcbmltcG9ydCB7IENvbnRhaW5lciwgaW5qZWN0IH0gZnJvbSAnZGVuYWxpJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmNvbnN0IGR1bW15QXBwUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICdkdW1teScpO1xuXG50ZXN0KCdtZXRhRm9yIHJldHVybnMgYSBjb250YWluZXItc2NvcGVkIG1ldGFkYXRhIG9iamVjdCcsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGxldCBrZXkgPSB7fTtcbiAgbGV0IG1ldGEgPSBjb250YWluZXIubWV0YUZvcihrZXkpO1xuICBtZXRhLmZvbyA9IHRydWU7XG4gIHQuaXMoY29udGFpbmVyLm1ldGFGb3Ioa2V5KSwgbWV0YSk7XG5cbiAgbGV0IG90aGVyQ29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICB0Lm5vdChvdGhlckNvbnRhaW5lci5tZXRhRm9yKGtleSksIG1ldGEpO1xufSk7XG5cbnRlc3QoJ2dldC9zZXRPcHRpb24gYWxsb3dzIG9wdGlvbnMgcGVyIHR5cGUnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCd0eXBlJywgJ3NpbmdsZXRvbicsIHRydWUpO1xuICB0LnRydWUoY29udGFpbmVyLmdldE9wdGlvbigndHlwZScsICdzaW5nbGV0b24nKSk7XG4gIHQudHJ1ZShjb250YWluZXIuZ2V0T3B0aW9uKCd0eXBlOmVudHJ5JywgJ3NpbmdsZXRvbicpKTtcbn0pO1xuXG50ZXN0KCdnZXQvc2V0T3B0aW9uIGFsbG93cyBvcHRpb25zIHBlciBzcGVjaWZpZXInLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCd0eXBlOmVudHJ5JywgJ3NpbmdsZXRvbicsIHRydWUpO1xuICB0LnRydWUoY29udGFpbmVyLmdldE9wdGlvbigndHlwZTplbnRyeScsICdzaW5nbGV0b24nKSk7XG59KTtcblxudGVzdCgnaW5zdGFudGlhdGU6IHRydWUsIHNpbmdsZXRvbjogdHJ1ZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5zZXRPcHRpb24oJ2ZvbycsICdzaW5nbGV0b24nLCB0cnVlKTtcbiAgY29udGFpbmVyLnNldE9wdGlvbignZm9vJywgJ2luc3RhbnRpYXRlJywgdHJ1ZSk7XG5cbiAgY2xhc3MgRm9vIHt9XG4gIGNvbnRhaW5lci5yZWdpc3RlcignZm9vOm1haW4nLCBGb28pO1xuICBsZXQgcmVzdWx0ID0gY29udGFpbmVyLmxvb2t1cCgnZm9vOm1haW4nKTtcblxuICB0LnRydWUocmVzdWx0IGluc3RhbmNlb2YgRm9vKTtcbiAgdC5pcyhyZXN1bHQsIGNvbnRhaW5lci5sb29rdXAoJ2ZvbzptYWluJykpO1xufSk7XG5cbnRlc3QoJ2luc3RhbnRpYXRlOiBmYWxzZSwgc2luZ2xldG9uOiB0cnVlJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnNldE9wdGlvbignZm9vJywgJ3NpbmdsZXRvbicsIHRydWUpO1xuICBjb250YWluZXIuc2V0T3B0aW9uKCdmb28nLCAnaW5zdGFudGlhdGUnLCBmYWxzZSk7XG5cbiAgbGV0IGZvbyA9IHt9O1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzptYWluJywgZm9vKTtcbiAgbGV0IHJlc3VsdCA9IGNvbnRhaW5lci5sb29rdXAoJ2ZvbzptYWluJyk7XG5cbiAgdC5pcyhyZXN1bHQsIGZvbyk7XG4gIHQuaXMocmVzdWx0LCBjb250YWluZXIubG9va3VwKCdmb286bWFpbicpKTtcbn0pO1xuXG50ZXN0KCdpbnN0YW50aWF0ZTogdHJ1ZSwgc2luZ2xldG9uOiBmYWxzZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5zZXRPcHRpb24oJ2ZvbycsICdzaW5nbGV0b24nLCBmYWxzZSk7XG4gIGNvbnRhaW5lci5zZXRPcHRpb24oJ2ZvbycsICdpbnN0YW50aWF0ZScsIHRydWUpO1xuXG4gIGNsYXNzIEZvbyB7fVxuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzptYWluJywgRm9vKTtcbiAgbGV0IHJlc3VsdCA9IGNvbnRhaW5lci5sb29rdXAoJ2ZvbzptYWluJyk7XG5cbiAgdC50cnVlKHJlc3VsdCBpbnN0YW5jZW9mIEZvbyk7XG4gIHQubm90KHJlc3VsdCwgY29udGFpbmVyLmxvb2t1cCgnZm9vOm1haW4nKSk7XG59KTtcblxudGVzdCgnc2hvdWxkIGRlZmF1bHQgdW5rbm93biB0eXBlcyB0byBpbnN0YW50aWF0ZTogZmFsc2UsIHNpbmdsZXRvbjogdHJ1ZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG5cbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286bWFpbicsIHsgZm9vOiB0cnVlIH0pO1xuICBsZXQgcmVzdWx0ID0gY29udGFpbmVyLmxvb2t1cCgnZm9vOm1haW4nKTtcblxuICB0LnRydWUocmVzdWx0LmZvbyk7XG59KTtcblxudGVzdCgncmVnaXN0ZXIodHlwZSwgdmFsdWUpIHJlZ2lzdGVycyBhIHZhbHVlIG9uIHRoZSBjb250YWluZXInLCBhc3luYyAodCkgPT4ge1xuICBsZXQgY29udGFpbmVyID0gbmV3IENvbnRhaW5lcihkdW1teUFwcFBhdGgpO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpiYXInLCB7IGJ1eno6IHRydWUgfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgdC50cnVlKGNvbnRhaW5lci5sb29rdXA8YW55PignZm9vOmJhcicpLmJ1enopO1xufSk7XG5cbnRlc3QoJ2xvb2t1cCh0eXBlKSBsb29rcyB1cCBhIG1vZHVsZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5yZWdpc3RlcignZm9vOmJhcicsIHsgYnV6ejogdHJ1ZSB9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICB0LnRydWUoY29udGFpbmVyLmxvb2t1cDxhbnk+KCdmb286YmFyJykuYnV6eik7XG59KTtcblxudGVzdCgnbG9va3VwQWxsKHR5cGUpIHJldHVybnMgYW4gb2JqZWN0IHdpdGggYWxsIHRoZSBtb2R1bGVzIG9mIHRoZSBnaXZlbiB0eXBlJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoZHVtbXlBcHBQYXRoKTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YmFyJywgeyBpc0JhcjogdHJ1ZSB9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzpidXp6JywgeyBpc0J1eno6IHRydWUgfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgbGV0IHR5cGUgPSBjb250YWluZXIubG9va3VwQWxsPGFueT4oJ2ZvbycpO1xuICB0LnRydXRoeSh0eXBlLmJhcik7XG4gIHQudHJ1ZSh0eXBlLmJhci5pc0Jhcik7XG4gIHQudHJ1dGh5KHR5cGUuYnV6eik7XG4gIHQudHJ1ZSh0eXBlLmJ1enouaXNCdXp6KTtcbn0pO1xuXG50ZXN0KCdsYXppbHkgaW5zdGFudGlhdGVzIHNpbmdsZXRvbnMgKGkuZS4gb24gbG9va3VwKScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGZ1bmN0aW9uIENsYXNzKCkge1xuICAgIHQuZmFpbCgnQ2xhc3Mgc2hvdWxkIG5vdCBoYXZlIGJlZW4gaW5zdGFudGlhdGVkLicpO1xuICB9XG4gIGNvbnRhaW5lci5yZWdpc3RlcignZm9vOmJhcicsIENsYXNzLCB7IHNpbmdsZXRvbjogdHJ1ZSB9KTtcbiAgdC5wYXNzKCk7XG59KTtcblxudGVzdCgnYXZhaWxhYmxlRm9yVHlwZSgpIHJldHVybnMgYWxsIHJlZ2lzdGVyZWQgaW5zdGFuY2VzIG9mIGEgdHlwZScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG5cbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YScsIHthOiB0cnVlfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YicsIHtiOiB0cnVlfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286YycsIHtjOiB0cnVlfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcbiAgY29udGFpbmVyLnJlZ2lzdGVyKCdmb286ZCcsIHtkOiB0cnVlfSwgeyBzaW5nbGV0b246IHRydWUsIGluc3RhbnRpYXRlOiBmYWxzZSB9KTtcblxuICB0LmRlZXBFcXVhbChjb250YWluZXIuYXZhaWxhYmxlRm9yVHlwZSgnZm9vJyksIFsnYScsICdiJywgJ2MnLCAnZCddKTtcbn0pO1xuXG50ZXN0KCdwcm9wZXJ0aWVzIG1hcmtlZCBhcyBpbmplY3Rpb25zIGFyZSBpbmplY3RlZCcsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBjb250YWluZXIgPSBuZXcgQ29udGFpbmVyKGR1bW15QXBwUGF0aCk7XG4gIGNvbnRhaW5lci5yZWdpc3RlcignYmFyOm1haW4nLCB7IGlzUHJlc2VudDogdHJ1ZSB9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBjb250YWluZXIucmVnaXN0ZXIoJ2ZvbzptYWluJywgeyBiYXI6IGluamVjdCgnYmFyOm1haW4nKSB9LCB7IHNpbmdsZXRvbjogdHJ1ZSwgaW5zdGFudGlhdGU6IGZhbHNlIH0pO1xuICBsZXQgZm9vID0gY29udGFpbmVyLmxvb2t1cDxhbnk+KCdmb286bWFpbicpO1xuXG4gIHQudHJ1ZShmb28uYmFyLmlzUHJlc2VudCwgJ2luamVjdGlvbiB3YXMgYXBwbGllZCcpO1xufSk7XG4iXX0=